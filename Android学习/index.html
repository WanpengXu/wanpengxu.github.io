<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="许">





<title>Android学习 | 须臾所学之野</title>



    <link rel="icon" href="/favicon.png">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        <!-- MathJax配置，可通过单美元符号书写行内公式等 -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    "HTML-CSS": {
        preferredFont: "TeX",
        availableFonts: ["STIX","TeX"],
        linebreaks: { automatic:true },
        EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
        inlineMath: [ ["$", "$"], ["\\(","\\)"] ],
        processEscapes: true,
        ignoreClass: "tex2jax_ignore|dno",
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        equationNumbers: { autoNumber: "AMS" },
        noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
        Macros: { href: "{}" }
    },
    messageStyle: "none"
    });
</script>
<!-- 给MathJax元素添加has-jax class -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<!-- 通过连接CDN加载MathJax的js代码 -->
<script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


    


<meta name="generator" content="Hexo 5.4.0"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Xuwp&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                    <a class="menu-item" href="/link">Links</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Xuwp&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                    <a class="menu-item" href="/link">Links</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6;    // 为 6 时展开所有
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function () {
            tocbot.refresh(obj_merge(tocbot_default_config, { hasInnerContainers: true }));
        }, 420); // 这个值是由 tocbot 源码里定义的 scrollSmoothDuration 得来的
    }

    document.ready(function () {
        tocbot.init(obj_merge(tocbot_default_config, { collapseDepth: 1 }));
    });

    function expandToc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, { collapseDepth: expanded ? 1 : DEPTH_MAX }));
        b.innerText = expanded ? 'Expand all' : 'Collapse all';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">Android学习</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">许</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">三月 12, 2022&nbsp;&nbsp;12:01:32</a>
                        </span>
                    
                    
                </div>
            
        </header>

        <div class="post-content">
            <h1 id="一些ERROR解决方法"><a href="#一些ERROR解决方法" class="headerlink" title="一些ERROR解决方法"></a>一些ERROR解决方法</h1><p>本文所提供方法仅保证能够work，不一定是最优的。</p>
<h2 id="gradle下载依赖缓慢、timeout"><a href="#gradle下载依赖缓慢、timeout" class="headerlink" title="gradle下载依赖缓慢、timeout"></a>gradle下载依赖缓慢、timeout</h2><p>方法一：在项目的settings.gradle中的repositories中添加国内镜像源，并<strong>允许使用不安全的仓库</strong>。</p>
<p><img src="https://cdn.jsdelivr.net/gh/WanpengXu/myPicGo/img/202203121212175.png" alt=""></p>
<p>方法二：连接至世界互联网，不多说了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/WanpengXu/myPicGo/img/202203121212340.png" alt=""></p>
<h2 id="一直Loading-Devices"><a href="#一直Loading-Devices" class="headerlink" title="一直Loading Devices"></a>一直Loading Devices</h2><p>下载老版本的platform-tools，替换sdk manager自动下载的最新版本。</p>
<p>经测试最新的可用版本是<code>platform-tools_r31.0.1-windows.zip</code></p>
<p>我的sdk目录：<code>C:\Users\XuWanpeng\AppData\Local\Android\Sdk\platform-tools</code></p>
<h2 id="关于kotlin-android-extensions"><a href="#关于kotlin-android-extensions" class="headerlink" title="关于kotlin-android-extensions"></a>关于kotlin-android-extensions</h2><p>详见《第一行代码——Android》作者郭霖的博客： <a target="_blank" rel="noopener" href="https://blog.csdn.net/guolin_blog/article/details/113089706">kotlin-android-extensions插件也被废弃了？扶我起来</a></p>
<p>Android Studio 4.1之后，这个插件已经不会再被自动引入，已经被deprecated了。</p>
<p>当然，我们可以手动引入这个插件</p>
<p><img src="https://cdn.jsdelivr.net/gh/WanpengXu/myPicGo/img/202203131303683.png" alt=""></p>
<p>但目前Google官方更推荐的，是使用<a target="_blank" rel="noopener" href="https://developer.android.com/topic/libraries/view-binding?hl=zh-cn">view-binging</a></p>
<p>这里附上使用控件实例的三种方法</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.activitytest</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle</span><br><span class="line"><span class="keyword">import</span> android.widget.Button  <span class="comment">// classical way</span></span><br><span class="line"><span class="keyword">import</span> android.widget.Toast</span><br><span class="line"><span class="keyword">import</span> com.example.activitytest.databinding.FirstLayoutBinding  <span class="comment">// view-binding</span></span><br><span class="line"><span class="comment">//import kotlinx.android.synthetic.main.first_layout.*  // kotlin-android-extensions</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FirstActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> binding: FirstLayoutBinding  <span class="comment">// view-binding</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.first_layout)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// classical way</span></span><br><span class="line"><span class="comment">//        val button1: Button = findViewById(R.id.button1)</span></span><br><span class="line"><span class="comment">//        button1.setOnClickListener &#123;</span></span><br><span class="line"><span class="comment">//            Toast.makeText(this, &quot;You clicked Button 1 by classical way&quot;, Toast.LENGTH_SHORT).show()</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// kotlin-android-extensions</span></span><br><span class="line"><span class="comment">//        button1.setOnClickListener &#123;</span></span><br><span class="line"><span class="comment">//            Toast.makeText(this, &quot;You clicked Button1 by kotlin-android-extensions&quot;, Toast.LENGTH_SHORT).show()</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// view-binding</span></span><br><span class="line">        binding = FirstLayoutBinding.inflate(layoutInflater)</span><br><span class="line">        <span class="keyword">val</span> view = binding.root</span><br><span class="line">        setContentView(view)</span><br><span class="line">        binding.button1.setOnClickListener &#123;</span><br><span class="line">            Toast.makeText(<span class="keyword">this</span>, <span class="string">&quot;You clicked Button1 by view-binding&quot;</span>, Toast.LENGTH_SHORT).show()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="运行Java代码报错：SourceSet-with-name-‘main’-not-found"><a href="#运行Java代码报错：SourceSet-with-name-‘main’-not-found" class="headerlink" title="运行Java代码报错：SourceSet with name ‘main’ not found"></a>运行Java代码报错：SourceSet with name ‘main’ not found</h2><p><img src="https://cdn.jsdelivr.net/gh/WanpengXu/myPicGo/img/202203132339973.png" alt=""></p>
<p>在<code>.idea</code>文件夹下的<code>gradle.xml</code>文件中添加<code>&lt;option name=&quot;delegatedBuild&quot; value=&quot;false&quot; /&gt;</code>，然后重新运行即可</p>
<p><img src="https://cdn.jsdelivr.net/gh/WanpengXu/myPicGo/img/202203132338026.png" alt=""></p>
<h2 id="adapterPosition返回-1"><a href="#adapterPosition返回-1" class="headerlink" title="adapterPosition返回-1"></a>adapterPosition返回-1</h2><p>最后一行应直接返回已创建的<code>viewHolder</code>，不能两次调用<code>ViewHolder()</code>。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreateViewHolder</span><span class="params">(parent: <span class="type">ViewGroup</span>, viewType: <span class="type">Int</span>)</span></span>: ViewHolder &#123;</span><br><span class="line">        <span class="keyword">val</span> view = LayoutInflater.from(parent.context).inflate(R.layout.fruit_item, parent, <span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> viewHolder = ViewHolder(view)</span><br><span class="line">        viewHolder.itemView.setOnClickListener &#123;</span><br><span class="line">            <span class="keyword">val</span> position = viewHolder.absoluteAdapterPosition</span><br><span class="line"></span><br><span class="line"><span class="comment">//            Log.e(&quot;tag&quot;, position.toString())</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">val</span> fruit = fruitList[position]</span><br><span class="line">            Toast.makeText(parent.context, <span class="string">&quot;You clicked view <span class="subst">$&#123;fruit.name&#125;</span>&quot;</span>, Toast.LENGTH_SHORT).show()</span><br><span class="line">        &#125;</span><br><span class="line">        viewHolder.fruitImage.setOnClickListener &#123;</span><br><span class="line">            <span class="keyword">val</span> position = viewHolder.absoluteAdapterPosition</span><br><span class="line"></span><br><span class="line"><span class="comment">//            Log.e(&quot;tag&quot;, position.toString())</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">val</span> fruit = fruitList[position]</span><br><span class="line">            Toast.makeText(parent.context, <span class="string">&quot;You clicked image <span class="subst">$&#123;fruit.name&#125;</span>&quot;</span>, Toast.LENGTH_SHORT).show()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> viewHolder  <span class="comment">// 这里不能写ViewHolder(view)</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h1 id="kotlin学习"><a href="#kotlin学习" class="headerlink" title="kotlin学习"></a>kotlin学习</h1><h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><p><strong>个人感觉：kotlin像一个”exJava”，将其很多难用的功能封装了起来，上手很快。</strong></p>
<p>可继承类open（kotlin官方认为所有数据类型最好是<code>final</code>的，如果不显式强调“可继承”、“可重新赋值”，那么就是<code>final</code>的）</p>
<p><code>Person.kt</code></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.helloworld</span><br><span class="line"></span><br><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>(<span class="keyword">var</span> name: String, <span class="keyword">var</span> age: <span class="built_in">Int</span>) &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">eat</span><span class="params">()</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;<span class="variable">$name</span> is eating. He is <span class="variable">$age</span> years old.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接口、默认实现</p>
<p><code>Study.kt</code></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.helloworld</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Study</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">readBooks</span><span class="params">()</span></span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">doHomework</span><span class="params">()</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;do homework default implementation.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>继承、实现接口（同样不可以多继承）、主次构造函数（把一堆重载的构造函数分了主次，次必须调用主）</p>
<p><code>Student.kt</code></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.helloworld</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span></span>(<span class="keyword">val</span> sid: String, <span class="keyword">val</span> grade: <span class="built_in">Int</span>, name: String, age: <span class="built_in">Int</span>) : Person(name, age), Study &#123;</span><br><span class="line">    <span class="keyword">init</span> &#123;</span><br><span class="line">        println(<span class="string">&quot;sid is: <span class="variable">$sid</span>, grade is: <span class="variable">$grade</span>, name is: <span class="variable">$name</span>, age is: <span class="variable">$age</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">constructor</span>(name: String, age: <span class="built_in">Int</span>) : <span class="keyword">this</span>(<span class="string">&quot;&quot;</span>, <span class="number">0</span>, name, age)</span><br><span class="line">    <span class="keyword">constructor</span>() : <span class="keyword">this</span>(<span class="string">&quot;&quot;</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">readBooks</span><span class="params">()</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;<span class="variable">$name</span> is reading.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    override fun doHomework() &#123;</span></span><br><span class="line"><span class="comment">//        println(&quot;$name is doing homework.&quot;)</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>数据类（不用手动实现<code>equals()</code>、<code>hashCode()</code>、<code>toString()</code>了）</p>
<p><code>CellPhone.kt</code></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.helloworld</span><br><span class="line"></span><br><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Cellphone</span></span>(<span class="keyword">val</span> brand: String, <span class="keyword">val</span> price: <span class="built_in">Double</span>)</span><br></pre></td></tr></table></figure>
<p>单例类（不用再写<code>if</code>判断是否第一次调用了）</p>
<p><code>Singleton.kt</code></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.helloworld</span><br><span class="line"></span><br><span class="line"><span class="keyword">object</span> Singleton &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">singletonTest</span><span class="params">()</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;singletonTest is called&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>LearnKotlin.kt</code></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.helloworld</span><br><span class="line"></span><br><span class="line"><span class="comment">//fun largerNumber(num1: Int, num2: Int): Int &#123;</span></span><br><span class="line"><span class="comment">//    return max(num1, num2)</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//fun largerNumber(num1: Int, num2: Int) = max(num1, num2)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">largerNumber</span><span class="params">(num1: <span class="type">Int</span>, num2: <span class="type">Int</span>)</span></span> = <span class="keyword">if</span> (num1 &gt; num2) num1 <span class="keyword">else</span> num2</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">doStudy</span><span class="params">(study : <span class="type">Study</span>?)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (study != <span class="literal">null</span>) &#123;</span><br><span class="line">        study.readBooks()</span><br><span class="line">        study.doHomework()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        println(<span class="string">&quot;object is null&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    println(<span class="string">&quot;Hello, Kotlin!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//    val a = 10</span></span><br><span class="line"><span class="comment">//    var a: Int = 10</span></span><br><span class="line"><span class="comment">//    a = a * 10</span></span><br><span class="line"><span class="comment">//    a *= 10</span></span><br><span class="line"><span class="comment">//    println(&quot;a = &quot; + a)</span></span><br><span class="line"><span class="comment">//    println(&quot;a = $a&quot;)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> a = <span class="number">37</span></span><br><span class="line">    <span class="keyword">val</span> b = <span class="number">40</span></span><br><span class="line">    <span class="keyword">val</span> value = largerNumber(a, b)</span><br><span class="line">    println(<span class="string">&quot;larger number is: <span class="variable">$value</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> p = Person(<span class="string">&quot;Jack&quot;</span>, <span class="number">19</span>)</span><br><span class="line">    p.eat()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> student1 = Student()</span><br><span class="line">    <span class="keyword">val</span> student2 = Student(<span class="string">&quot;Jack&quot;</span>, <span class="number">19</span>)</span><br><span class="line">    <span class="keyword">val</span> student3 = Student(<span class="string">&quot;a123&quot;</span>, <span class="number">5</span>, <span class="string">&quot;Jack&quot;</span>, <span class="number">19</span>)</span><br><span class="line"></span><br><span class="line">    doStudy(student2)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> cellphone1 = Cellphone(<span class="string">&quot;Samsung&quot;</span>, <span class="number">1299.99</span>)</span><br><span class="line">    <span class="keyword">val</span> cellphone2 = Cellphone(<span class="string">&quot;Samsung&quot;</span>, <span class="number">1299.99</span>)</span><br><span class="line"></span><br><span class="line">    println(cellphone1)  <span class="comment">// toString</span></span><br><span class="line">    println(<span class="string">&quot;cellphone1 equals cellphone2: <span class="subst">$&#123;cellphone1 == cellphone2&#125;</span>&quot;</span>)  <span class="comment">// equals</span></span><br><span class="line"></span><br><span class="line">    Singleton.singletonTest()  <span class="comment">// 前面那个其实是实例</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> list = listOf(<span class="string">&quot;Apple&quot;</span>, <span class="string">&quot;Banana&quot;</span>, <span class="string">&quot;Orange&quot;</span>, <span class="string">&quot;Pear&quot;</span>, <span class="string">&quot;Grape&quot;</span>)</span><br><span class="line"><span class="comment">//    list.add(&quot;Watermelon&quot;)  // ERROR: Unresolved reference: add</span></span><br><span class="line">    <span class="keyword">for</span> (fruit <span class="keyword">in</span> list) &#123;</span><br><span class="line">        println(fruit)</span><br><span class="line">    &#125;</span><br><span class="line">    println()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> mutableList = mutableListOf(<span class="string">&quot;Apple&quot;</span>, <span class="string">&quot;Banana&quot;</span>, <span class="string">&quot;Orange&quot;</span>, <span class="string">&quot;Pear&quot;</span>, <span class="string">&quot;Grape&quot;</span>)</span><br><span class="line">    mutableList.add(<span class="string">&quot;Watermelon&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> (fruit <span class="keyword">in</span> mutableList) &#123;</span><br><span class="line">        println(fruit)</span><br><span class="line">    &#125;</span><br><span class="line">    println()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> <span class="keyword">set</span> = setOf(<span class="string">&quot;Apple&quot;</span>, <span class="string">&quot;Banana&quot;</span>, <span class="string">&quot;Orange&quot;</span>, <span class="string">&quot;Pear&quot;</span>, <span class="string">&quot;Grape&quot;</span>, <span class="string">&quot;Apple&quot;</span>)</span><br><span class="line"><span class="comment">//    set.add(&quot;Watermelon&quot;)  // ERROR: Unresolved reference: add</span></span><br><span class="line">    <span class="keyword">for</span> (fruit <span class="keyword">in</span> <span class="keyword">set</span>) &#123;</span><br><span class="line">        println(fruit)</span><br><span class="line">    &#125;</span><br><span class="line">    println()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> mutableSet = mutableSetOf(<span class="string">&quot;Apple&quot;</span>, <span class="string">&quot;Banana&quot;</span>, <span class="string">&quot;Orange&quot;</span>, <span class="string">&quot;Pear&quot;</span>, <span class="string">&quot;Grape&quot;</span>, <span class="string">&quot;Apple&quot;</span>)</span><br><span class="line">    mutableSet.add(<span class="string">&quot;Watermelon&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> (fruit <span class="keyword">in</span> mutableSet) &#123;</span><br><span class="line">        println(fruit)</span><br><span class="line">    &#125;</span><br><span class="line">    println()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> map = mapOf(<span class="string">&quot;Apple&quot;</span> to <span class="number">1</span>, <span class="string">&quot;Banana&quot;</span> to <span class="number">2</span>, <span class="string">&quot;Orange&quot;</span> to <span class="number">3</span>, <span class="string">&quot;Pear&quot;</span> to <span class="number">4</span>, <span class="string">&quot;Grape&quot;</span> to <span class="number">5</span>)</span><br><span class="line"><span class="comment">//    map[&quot;Watermelon&quot;] = 6  // ERROR: No set method providing array access</span></span><br><span class="line">    <span class="keyword">for</span> ((fruit, number) <span class="keyword">in</span> map) &#123;</span><br><span class="line">        println(<span class="string">&quot;fruit is <span class="variable">$fruit</span>, number is <span class="variable">$number</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    println()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> mutableMap = mutableMapOf(<span class="string">&quot;Apple&quot;</span> to <span class="number">1</span>, <span class="string">&quot;Banana&quot;</span> to <span class="number">2</span>, <span class="string">&quot;Orange&quot;</span> to <span class="number">3</span>, <span class="string">&quot;Pear&quot;</span> to <span class="number">4</span>, <span class="string">&quot;Grape&quot;</span> to <span class="number">5</span>)</span><br><span class="line">    mutableMap[<span class="string">&quot;Watermelon&quot;</span>] = <span class="number">6</span></span><br><span class="line">    <span class="keyword">for</span> ((fruit, number) <span class="keyword">in</span> mutableMap)</span><br><span class="line">        println(<span class="string">&quot;fruit is <span class="variable">$fruit</span>, number is <span class="variable">$number</span>&quot;</span>)</span><br><span class="line">    println()</span><br><span class="line"></span><br><span class="line"><span class="comment">//    val lambda = &#123;fruit: String -&gt; fruit.length&#125;</span></span><br><span class="line">    <span class="keyword">val</span> maxLengthFruit = mutableList.maxByOrNull &#123; it.length &#125;</span><br><span class="line">    println(<span class="string">&quot;max Length fruit is <span class="variable">$maxLengthFruit</span>&quot;</span>)</span><br><span class="line">    println()</span><br><span class="line"></span><br><span class="line"><span class="comment">//    val newList = list.map &#123; it.toUpperCase() &#125;</span></span><br><span class="line">    <span class="keyword">val</span> newList = list.filter &#123; it.length &lt;= <span class="number">5</span> &#125;</span><br><span class="line">                      .map &#123; it.uppercase() &#125;</span><br><span class="line">    <span class="keyword">for</span> (fruit <span class="keyword">in</span> newList) &#123;</span><br><span class="line">        println(fruit)</span><br><span class="line">    &#125;</span><br><span class="line">    println()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> anyResult = list.any &#123; it.length &lt;= <span class="number">5</span> &#125;</span><br><span class="line">    <span class="keyword">val</span> allResult = list.all &#123; it.length &lt;= <span class="number">5</span> &#125;</span><br><span class="line">    println(<span class="string">&quot;anyResult is <span class="variable">$anyResult</span>, allResult is <span class="variable">$allResult</span>&quot;</span>)</span><br><span class="line">    println()</span><br><span class="line"></span><br><span class="line">    Thread &#123;</span><br><span class="line">        println(<span class="string">&quot;Thread is running&quot;</span>)</span><br><span class="line">    &#125;.start()</span><br><span class="line"></span><br><span class="line">    doStudy(<span class="literal">null</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="标准函数、静态方法"><a href="#标准函数、静态方法" class="headerlink" title="标准函数、静态方法"></a>标准函数、静态方法</h2><h3 id="标准函数with、run和apply"><a href="#标准函数with、run和apply" class="headerlink" title="标准函数with、run和apply"></a>标准函数<code>with</code>、<code>run</code>和<code>apply</code></h3><p><code>with</code>的使用像一个静态方法，需要传入<code>object</code>和<code>lambda</code>，可能需要判空。</p>
<p><code>run</code>的功能类似<code>with</code>，是一个实例方法，用<code>object</code>调用它，只需要传入<code>lambda</code>，优点是可以使用<code>?.</code>判空。（这一点又类似<code>let</code>）</p>
<p><code>apply</code>类似<code>run</code>，但它的<code>lambda</code>语句块不将最后一行作为返回值。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.activitytest</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.StringBuilder</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> list = listOf(<span class="string">&quot;Apple&quot;</span>, <span class="string">&quot;Banana&quot;</span>, <span class="string">&quot;Orange&quot;</span>, <span class="string">&quot;Pear&quot;</span>, <span class="string">&quot;Grape&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> result = with(StringBuilder()) &#123;</span><br><span class="line">        append(<span class="string">&quot;Start eating fruits.\n&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> (fruit <span class="keyword">in</span> list) &#123;</span><br><span class="line">            append(fruit).append(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        append(<span class="string">&quot;Ate all fruits&quot;</span>)</span><br><span class="line">        toString()</span><br><span class="line">    &#125;</span><br><span class="line">    println(result)  <span class="comment">// string</span></span><br><span class="line">    println()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> list2 = listOf(<span class="string">&quot;Apple&quot;</span>, <span class="string">&quot;Banana&quot;</span>, <span class="string">&quot;Orange&quot;</span>, <span class="string">&quot;Pear&quot;</span>, <span class="string">&quot;Grape&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> result2 = StringBuilder().run &#123;</span><br><span class="line">        append(<span class="string">&quot;Start eating fruits.\n&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> (fruit <span class="keyword">in</span> list2) &#123;</span><br><span class="line">            append(fruit).append(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        append(<span class="string">&quot;Ate all fruits&quot;</span>)</span><br><span class="line">        toString()</span><br><span class="line">    &#125;</span><br><span class="line">    println(result2)  <span class="comment">// string</span></span><br><span class="line">    println()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> list3 = listOf(<span class="string">&quot;Apple&quot;</span>, <span class="string">&quot;Banana&quot;</span>, <span class="string">&quot;Orange&quot;</span>, <span class="string">&quot;Pear&quot;</span>, <span class="string">&quot;Grape&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> result3 = StringBuilder().apply &#123;</span><br><span class="line">        append(<span class="string">&quot;Start eating fruits.\n&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> (fruit <span class="keyword">in</span> list3) &#123;</span><br><span class="line">            append(fruit).append(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        append(<span class="string">&quot;Ate all fruits&quot;</span>)</span><br><span class="line"><span class="comment">//        toString()</span></span><br><span class="line">    &#125;</span><br><span class="line">    println(result3.toString())  <span class="comment">// StringBuilder（鼠标放上去看一下）</span></span><br><span class="line">    println()</span><br><span class="line"></span><br><span class="line">    doSomething()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="静态方法"><a href="#静态方法" class="headerlink" title="静态方法"></a>静态方法</h3><p>kotlin中极力弱化了静态方法，官方推荐使用<strong>单例类</strong>和<strong>伴生类（companion object）</strong>中的实例方法以尽可能地模拟静态方法。</p>
<p>但kotlin官方也提供了两种静态方法的实现方式：<strong>注解</strong>（<code>@JvmStatic</code>）和<strong>顶层方法</strong></p>
<p>顶层方法：</p>
<p><code>Helper.kt</code></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.activitytest</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">doSomething</span><span class="params">()</span></span> &#123;</span><br><span class="line">    println(<span class="string">&quot;do something&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>JavaTest.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.activitytest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JavaTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">invokeStaticMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        HelperKt.doSomething();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        HelperKt.doSomething();</span><br><span class="line"></span><br><span class="line">        JavaTest javaTest = <span class="keyword">new</span> JavaTest();</span><br><span class="line">        javaTest.invokeStaticMethod();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>output</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">do something</span><br><span class="line">do something</span><br></pre></td></tr></table></figure>
<p>注意：kotlin编译器在很多情况下都会将<strong>源文件及其后缀</strong>编译为<strong>大驼峰命名法</strong>的形式。</p>
<h2 id="延迟初始化、密封类"><a href="#延迟初始化、密封类" class="headerlink" title="延迟初始化、密封类"></a>延迟初始化、密封类</h2><h3 id="延迟初始化"><a href="#延迟初始化" class="headerlink" title="延迟初始化"></a>延迟初始化</h3><p>首先我们来看这样一段代码：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> : <span class="type">AppCompatActivity</span></span>(), View.OnClickListener&#123;</span><br><span class="line">	...</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> adapter: MsgAdapter? = <span class="literal">null</span></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">		...</span><br><span class="line">        adapter = MsgAdapter(msgList)</span><br><span class="line">		...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onClick</span><span class="params">(v: <span class="type">View</span>?)</span></span> &#123;</span><br><span class="line">		...</span><br><span class="line">        adapter?.notifyItemInserted(msgList.size - <span class="number">1</span>)</span><br><span class="line">		...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里是通过对本类<strong>实现事件处理接口</strong>来实现鼠标点击监听器的，因程序自身逻辑，在<code>onCreate</code>和<code>onClick</code>两个方法中都会用到同一个变量<code>adapter</code>。</p>
<p>那么我们首先应在类中将<code>adapter</code>赋值为<code>null</code>，同时把它的类型声明成<code>MsgAdapter?</code>，<code>?</code>代表允许为空。</p>
<p>但这样就带来了一个问题，既然类型是可能为空的<code>MsgAdapter?</code>，那么在使用这个变量的方法时也要不断地使用<code>?.</code>对其判空，可以想象，当工程量变大时，这个可能为空的变量会带来多少个<code>?.</code>和<code>?:</code>。</p>
<p>有一种办法可以解决这个问题：使用<code>lateinit</code>关键字，对变量进行<strong>延迟初始化</strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> : <span class="type">AppCompatActivity</span></span>(), View.OnClickListener&#123;</span><br><span class="line">	...</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> adapter: MsgAdapter  <span class="comment">// change1</span></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">		...</span><br><span class="line">        adapter = MsgAdapter(msgList)</span><br><span class="line">		...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onClick</span><span class="params">(v: <span class="type">View</span>?)</span></span> &#123;</span><br><span class="line">		...</span><br><span class="line">        adapter.notifyItemInserted(msgList.size - <span class="number">1</span>)  <span class="comment">// change2</span></span><br><span class="line">		...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用这个关键字后，就可将变量中的<code>?</code>去掉，代表它是一个延迟初始化的非空变量。后续调用其方法时也不再需要使用<code>?.</code>对其进行空检查。</p>
<p>但这样是有风险的，因为kotlin编译器相信开发者会在对变量赋值后再调用它的方法，所以如果开发者没有这样做，编译器只能在编译时才能爆出<code>UninitializedPropertyAccessException</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/WanpengXu/myPicGo/img/202203160100053.png" alt=""></p>
<p><strong>所以若你对一个全局变量使用了<code>lateinit</code>关键字，请确保它在被调用之前已完成了初始化工作。</strong></p>
<p>另外，我们可以检查<code>lateinit var</code>是否被初始化﻿，方法是在它的<strong>属性引用</strong>上使用<code>.isInitialized</code></p>
<p>属性引用我觉得可以单开一小节，这里我们只需要知道</p>
<blockquote>
<p>要将属性作为 Kotlin 中的一等对象访问，请使用<code>::</code>运算符</p>
</blockquote>
<p>接着我们可以得到这样的代码：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> : <span class="type">AppCompatActivity</span></span>(), View.OnClickListener&#123;</span><br><span class="line">	...</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> adapter: MsgAdapter  <span class="comment">// change1</span></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">		...</span><br><span class="line">        <span class="keyword">if</span> (!::adapter.isInitialized)  <span class="comment">// change3</span></span><br><span class="line">            adapter = MsgAdapter(msgList)</span><br><span class="line">		...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onClick</span><span class="params">(v: <span class="type">View</span>?)</span></span> &#123;</span><br><span class="line">		...</span><br><span class="line">        adapter.notifyItemInserted(msgList.size - <span class="number">1</span>)  <span class="comment">// change2</span></span><br><span class="line">		...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后，即使采用这些方法后<code>lateinit var</code>只被初始化了一次，但我们仍不能将<code>lateinit</code>作用于<code>val</code>。</p>
<p><img src="https://cdn.jsdelivr.net/gh/WanpengXu/myPicGo/img/202203160110817.png" alt=""></p>
<p>补充：<code>?.</code>只会对可能为空的变量生效</p>
<p>补充：依賴注入（Dependency Injection）</p>
<h3 id="密封类"><a href="#密封类" class="headerlink" title="密封类"></a>密封类</h3><h1 id="开发一个新闻项目"><a href="#开发一个新闻项目" class="headerlink" title="开发一个新闻项目"></a>开发一个新闻项目</h1><h2 id="第一次开发"><a href="#第一次开发" class="headerlink" title="第一次开发"></a>第一次开发</h2><p>参考腾讯新闻，使用Snipaste截图软件可以估算每个item的px，2px = 1dp，同时也可以查看像素点的RGB色相（神奇，我才发现）</p>
<p>关于怎样安装本地APK（但是不能安装腾讯新闻，似乎因为它是x86的）</p>
<p><a target="_blank" rel="noopener" href="https://waylau.com/android-studio-emulator-install-app/">https://waylau.com/android-studio-emulator-install-app/</a></p>
<p>首先打开腾讯新闻</p>
<p>发现每条新闻的大概是这样的</p>
<p><img src="https://cdn.jsdelivr.net/gh/WanpengXu/myPicGo/img/202203280128496.png" alt=""></p>
<p>我们先照着它扒一个item下来</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;100dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:paddingLeft</span>=<span class="string">&quot;12dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:paddingRight</span>=<span class="string">&quot;12dp&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">View</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;0.5dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">&quot;#E6E6E6&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:paddingTop</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:paddingBottom</span>=<span class="string">&quot;10dp&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">RelativeLayout</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;0dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_weight</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_alignParentTop</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">&quot;详情公布！宜春高安新增1无症状感染者&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:textColor</span>=<span class="string">&quot;#1E1E1E&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:textSize</span>=<span class="string">&quot;18sp&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:textStyle</span>=<span class="string">&quot;bold&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_alignParentBottom</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">&quot;都市现场 昨天16:38&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:textColor</span>=<span class="string">&quot;#999999&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:textSize</span>=<span class="string">&quot;10sp&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">tools:ignore</span>=<span class="string">&quot;SmallSp&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">com.makeramen.roundedimageview.RoundedImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;0dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:riv_corner_radius</span>=<span class="string">&quot;6dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_weight</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/news_image&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">com.makeramen.roundedimageview.RoundedImageView</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">View</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;0.5dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">&quot;#E6E6E6&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>圆角部分在github上面找了一个库<a target="_blank" rel="noopener" href="https://github.com/vinc3m1/RoundedImageView">RoundedImageView</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/WanpengXu/myPicGo/img/202203280145227.png" alt=""></p>
<p>效果不错，明天再做。</p>
<h2 id="第二次开发"><a href="#第二次开发" class="headerlink" title="第二次开发"></a>第二次开发</h2><p>上次开发只是为了测试item的效果，使用了<code>ScrollView-LinearLayout-layout*n</code>这种结构</p>
<p>这次使用RecyclerView对主界面进行重构。</p>
<p>来研究一下ScrollView、ListView和RecyclerView的区别：</p>
<p><code>ScrollView</code>：A view group that allows the view hierarchy placed within it to be scrolled.（一个视图组，允许被放置在它里面的视图滚动） 它非常适合处理需要滚动的<strong>不规则</strong>视图的<strong>组合</strong>。也就是说，这种View最主要的工作，就是让<strong>一个</strong>显示不下的View可以滚动以显示完全。</p>
<p><code>ListView</code>：Displays a vertically-scrollable collection of views, where each view is positioned immediatelybelow the previous view in the list.（显示一个可垂直滚动的视图集合，其中每个视图都位于列表中前一个视图的正下方）从这个描述中可以看出，这种View显示一个View集合，而集合中都是相同类型的元素（例如<code>ArrayList&lt;news&gt;</code>，元素是对象），所以它适用于处理需要滚动的<strong>规则</strong>视图的<strong>集合</strong>。也就是说，这种View最主要的工作就是让一个数据集合垂直滚动。</p>
<p><code>RecyclerView</code>：A flexible view for providing a limited window into a large data set.（一个灵活的视图，提供有限的窗口给大型数据集）从描述上看，好像也只多了“灵活的”、“大型”这两个定语。事实上，这两个定语对于ListView来说是一种巨大的提升。相较于ListView，“灵活的”体现在RecyclerView可以水平滚动、拥有瀑布流布局等，“大型”体现在其使用了四级缓存机制，有效地提高了性能。它的编写更加规范化，这也提高了编写的成本。总而言之，这种View用于让<strong>大型</strong>数据集拥有<strong>多样的展示方式</strong>，它兼容并包，胜任几乎所有工作。</p>
<p>注意：使用ScrollView的界面滑动时右侧会有滚动条，很好辨别。</p>
<p>既然RecyclerView显示数据集，那么首先我们要有数据</p>
<p>定义Model.kt</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">News</span></span>(<span class="keyword">val</span> title: String, <span class="keyword">val</span> description: String, <span class="keyword">val</span> imageURL: String)</span><br></pre></td></tr></table></figure>
<p>要让一个类包含图片，可以把图片的URL作为类的字段。</p>
<p>把使用到的图片上传到我的图床以获取URL。</p>
<p><code>https://cdn.jsdelivr.net/gh/WanpengXu/myPicGo/img/202203281026613.png</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/WanpengXu/myPicGo/img/202203281721826.png" alt=""></p>
<p>有数据类了当然也要有数据对象的集合</p>
<p>定义一个List，在里面构造几个对象。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> newsList = listOf(</span><br><span class="line">        News(</span><br><span class="line">            <span class="string">&quot;详情公布！宜春高安新增1无症状感染者1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;都市现场   昨天16:38&quot;</span>,</span><br><span class="line">            <span class="string">&quot;https://cdn.jsdelivr.net/gh/WanpengXu/myPicGo/img/202203281026613.png&quot;</span></span><br><span class="line">        ),</span><br><span class="line">        News(</span><br><span class="line">            <span class="string">&quot;详情公布！宜春高安新增1无症状感染者2&quot;</span>,</span><br><span class="line">            <span class="string">&quot;都市现场   昨天16:38&quot;</span>,</span><br><span class="line">            <span class="string">&quot;https://cdn.jsdelivr.net/gh/WanpengXu/myPicGo/img/202203281026613.png&quot;</span></span><br><span class="line">        ),</span><br><span class="line">        ...</span><br><span class="line">        News(</span><br><span class="line">            <span class="string">&quot;详情公布！宜春高安新增1无症状感染者10&quot;</span>,</span><br><span class="line">            <span class="string">&quot;都市现场   昨天16:38&quot;</span>,</span><br><span class="line">            <span class="string">&quot;https://cdn.jsdelivr.net/gh/WanpengXu/myPicGo/img/202203281026613.png&quot;</span></span><br><span class="line">        )</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
<p>接下来就要导入<code>RecyclerView</code></p>
<p>在<code>activity_main</code>中添加它</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">androidx.recyclerview.widget.RecyclerView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/news_recycler_view&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>接着在创建Activity的同时把它初始化，在<code>onCreate()</code>方法中添加</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> newsRecyclerView = findViewById&lt;RecyclerView&gt;(R.id.news_recycler_view)  <span class="comment">// classic</span></span><br><span class="line">      newsRecyclerView.layoutManager = LinearLayoutManager(<span class="keyword">this</span>)</span><br><span class="line">      newsRecyclerView.adapter = NewsAdapter(newsList)</span><br></pre></td></tr></table></figure>
<p>其中，<code>LinearLayoutManager</code>就要按参数类型<code>context</code>传入实参，它译作“上下文”，是一个抽象类，它的继承关系如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/WanpengXu/myPicGo/img/202203281954092.png" alt=""></p>
<p>我们最经常填入的是<code>Activity</code>的子类<code>MainActivity</code>，对于该类型的参数，我们有三种经常使用的方式：</p>
<ol>
<li><p>在MainActivity类中：直接填入<code>this</code></p>
</li>
<li><p>方法接受了parent参数：可填入<code>parent.context</code></p>
</li>
<li><p>在其他类中：将其作为<code>MainActivity</code>的内部类，填入<code>this@MainActivity</code></p>
</li>
<li><p>全局<code>Context</code>：</p>
<p>新建这样一个类</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> : <span class="type">Application</span></span>() &#123;</span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">        <span class="meta">@SuppressLint(<span class="meta-string">&quot;StaticFieldLeak&quot;</span>)</span></span><br><span class="line">        <span class="keyword">lateinit</span> <span class="keyword">var</span> context: Context</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate()</span><br><span class="line">        context = baseContext</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在<code>AndroidManifest.xml</code>中指定它为程序启动时初始化的类，加入<code>android:name=&quot;.MyApplication&quot;</code></p>
<p>这样就可以使用<code>MyApplication.context</code>获取全局Context了。</p>
<p>（详见《第一行代码》Chap14）</p>
</li>
</ol>
<p>接着，我们需要创建之前用到的类<code>NewsAdapter</code>，如下：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将自定义Adapter作为MainActivity的内部类是为了获取它作为上下文Context</span></span><br><span class="line">    <span class="keyword">inner</span> <span class="class"><span class="keyword">class</span> <span class="title">NewsAdapter</span></span>(<span class="keyword">private</span> <span class="keyword">val</span> newsList: List&lt;News&gt;) :</span><br><span class="line">        RecyclerView.Adapter&lt;NewsAdapter.NewsViewHolder&gt;() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将自定义ViewHolder作为自定义Adapter的内部类是一种习惯（使用它的地方记得更改为获取内部类的方式）</span></span><br><span class="line">        <span class="keyword">inner</span> <span class="class"><span class="keyword">class</span> <span class="title">NewsViewHolder</span></span>(itemView: View) : RecyclerView.ViewHolder(itemView) &#123;</span><br><span class="line">            <span class="keyword">val</span> title: TextView = itemView.findViewById(R.id.news_title)</span><br><span class="line">            <span class="keyword">val</span> description: TextView = itemView.findViewById(R.id.news_description)</span><br><span class="line">            <span class="keyword">val</span> image: com.makeramen.roundedimageview.RoundedImageView =</span><br><span class="line">                itemView.findViewById(R.id.news_image)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreateViewHolder</span><span class="params">(parent: <span class="type">ViewGroup</span>, viewType: <span class="type">Int</span>)</span></span>: NewsViewHolder &#123;</span><br><span class="line">            <span class="keyword">val</span> itemView =</span><br><span class="line">                LayoutInflater.from(parent.context)</span><br><span class="line">                    .inflate(R.layout.news_item_one_image, parent, <span class="literal">false</span>)</span><br><span class="line">            <span class="keyword">return</span> NewsViewHolder(itemView)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onBindViewHolder</span><span class="params">(holder: <span class="type">NewsViewHolder</span>, position: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">            <span class="keyword">val</span> news = newsList[position]</span><br><span class="line">            holder.title.text = news.title</span><br><span class="line">            holder.description.text = news.description</span><br><span class="line">            <span class="comment">// 加载图片。为获取Activity，将其作为MainActivity的内部类</span></span><br><span class="line">            Glide.with(<span class="keyword">this</span><span class="symbol">@MainActivity</span>).load(news.imageURL).into(holder.image)</span><br><span class="line"></span><br><span class="line">            holder.itemView.setOnClickListener &#123;</span><br><span class="line"><span class="comment">//                Toast.makeText(</span></span><br><span class="line"><span class="comment">//                    this@MainActivity,</span></span><br><span class="line"><span class="comment">//                    &quot;你好！我的下标是$&#123;holder.adapterPosition&#125;！&quot;,</span></span><br><span class="line"><span class="comment">//                    Toast.LENGTH_SHORT</span></span><br><span class="line"><span class="comment">//                ).show()</span></span><br><span class="line">                <span class="comment">// 一般自定义工具方法更方便</span></span><br><span class="line">                <span class="string">&quot;你好！我的下标是<span class="subst">$&#123;holder.adapterPosition&#125;</span>！&quot;</span>.showToast()</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getItemCount</span><span class="params">()</span></span> = newsList.size</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>ViewHolder是一个类，它用于获取一个视图、对该视图内的控件进行绑定，对其实例化后可通过方法调用符<code>.</code>直接对视图的属性赋值，避免了多次调用<code>findViewById()</code>。（大概这个意思）</p>
<p>创建工具方法<code>String.showToast()</code>可以让弹窗变得简单，在package下新建<code>/Util/ToastUtil.kt</code>，填入</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> String.<span class="title">showToast</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Toast.makeText(</span><br><span class="line">        MyApplication.context,</span><br><span class="line">        <span class="keyword">this</span>,</span><br><span class="line">        Toast.LENGTH_SHORT</span><br><span class="line">    ).show()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>即可。</p>
<p>关于更换主题色：在<code>/res/values</code>目录下，<code>colors.xml</code>中可以存储颜色，<code>themes.xml</code>可以使用颜色。选取颜色可以先随便输入一串RGB（如<code>#ffffff</code>）然后点左边的颜色进行高级取色。</p>
<p><img src="https://cdn.jsdelivr.net/gh/WanpengXu/myPicGo/img/202203282046649.png" alt=""></p>
<p>感觉不错，晚上再做。</p>
<h2 id="第三次开发"><a href="#第三次开发" class="headerlink" title="第三次开发"></a>第三次开发</h2><h2 id="…（很多次开发）"><a href="#…（很多次开发）" class="headerlink" title="…（很多次开发）"></a>…（很多次开发）</h2><h2 id="成果"><a href="#成果" class="headerlink" title="成果"></a>成果</h2><p>本应用采用kotlin语言编写，模仿了《腾讯新闻》及《哔哩哔哩》客户端。</p>
<p>打开app，进入MainActivity。</p>
<p><img src="https://cdn.jsdelivr.net/gh/WanpengXu/myPicGo/img/202204010921368.png" alt=""></p>
<p>首先，app对状态栏和导航栏（虚拟按键）做了沉浸式优化。</p>
<p>自上而下看，</p>
<p>首先是一个AppBarLayout，内含用户头像、搜索框和两个装在toolbar中的按钮。</p>
<p>当点击搜索框时，会弹出SearchActivity，你可以点击这里进行新闻搜索。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th><img src="https://cdn.jsdelivr.net/gh/WanpengXu/myPicGo/img/202204010927534.png" alt=""></th>
<th><img src="https://cdn.jsdelivr.net/gh/WanpengXu/myPicGo/img/202204010927932.png" alt=""></th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
</div>
<p>接下来是一行TabLayout，当新闻种类超出屏幕范围时，它可以横向滚动查看其他种类的新闻。</p>
<p><img src="https://cdn.jsdelivr.net/gh/WanpengXu/myPicGo/img/202204010925446.png" alt=""></p>
<p>接下来是一个news_fragment，包含SwipeRefreshLayout-<strong>RecyclerView</strong>结构以实现可下拉刷新的滑动新闻列表，可以点击列表项弹出ContentActivity以查看新闻。</p>
<p><img src="https://cdn.jsdelivr.net/gh/WanpengXu/myPicGo/img/202204010925109.png" alt="Screenshot_20220331_041717"> </p>
<p><img src="https://cdn.jsdelivr.net/gh/WanpengXu/myPicGo/img/202204010925182.png" alt=""></p>
<p>ContentActivity中加入了home按钮（左上角箭头）可以在递归刷新闻过深时（要按很多次返回键）直接finish该Activity。</p>
<p>接着是一个自定义底部导航栏bottomNav，该导航栏会在启动时直接加载至fragment_home，可通过点击其他item切换至其他fragment。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th><img src="https://cdn.jsdelivr.net/gh/WanpengXu/myPicGo/img/202204010928597.png" alt=""></th>
<th><img src="https://cdn.jsdelivr.net/gh/WanpengXu/myPicGo/img/202204010928540.png" alt=""></th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
</div>
<p>因作业主要内容是实现一个新闻列表，所以其他两个fragment还没怎么做，目前能点一点按钮。</p>
<p>注：因京东API每日获取新闻不超过1000条，每次启动APP会获取70条新闻，所以若一天中打开了15次及以上，我写了一个catch将其捕获后Toast。</p>
<p><img src="https://cdn.jsdelivr.net/gh/WanpengXu/myPicGo/img/202204010929922.jpg" alt=""></p>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>许</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="http://xuwp.top/Android%E5%AD%A6%E4%B9%A0/">http://xuwp.top/Android%E5%AD%A6%E4%B9%A0/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span>Do you believe in <strong>DESTINY</strong>?</span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/Android/"># Android</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94DHCP%E8%80%97%E5%B0%BD%E6%94%BB%E5%87%BB/">中间人攻击——DHCP耗尽攻击</a>
            
            
            <a class="next" rel="next" href="/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95%E7%AB%9E%E8%B5%9B/">系统学习算法竞赛</a>
            
        </section>


    </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>© 许 | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>

</html>